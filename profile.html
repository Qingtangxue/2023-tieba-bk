<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ä¸ªäººä¸­å¿ƒ - ç™¾åº¦è´´å§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FF6B35;
            text-decoration: none;
        }
        
        .navbar-nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-link {
            color: #666;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-link:hover {
            color: #FF6B35;
        }
        
        .nav-link.active {
            color: #FF6B35;
            font-weight: 600;
        }
        
        .profile-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .profile-header {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .profile-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B35 0%, #E55A2B 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
        
        .user-details h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .user-details p {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007AFF;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 2rem;
        }
        
        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .post-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .post-card:hover {
            transform: translateY(-2px);
        }
        
        .post-image {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .post-content-wrapper {
            flex: 1;
        }
        
        .post-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .post-content {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #999;
        }
        
        .bars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .bar-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .bar-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .bar-members {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #007AFF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056CC;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #007AFF;
            color: #007AFF;
        }
        
        .btn-outline:hover {
            background: #007AFF;
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .empty-state h3 {
            margin-bottom: 1rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .navbar-nav {
                gap: 1rem;
            }
            
            .profile-container {
                padding: 0 1rem;
            }
            
            .profile-header {
                padding: 2rem;
            }
            
            .profile-info {
                flex-direction: column;
                text-align: center;
            }
            
            .stats {
                justify-content: center;
            }
            
            .posts-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">ç™¾åº¦è´´å§</a>
        <div class="navbar-nav">
            <a href="index.html" class="nav-link" onclick="clearCacheAndNavigate('index.html')">é¦–é¡µ</a>
            <a href="bars.html" class="nav-link">è´´å§</a>
            <a href="profile.html" class="nav-link active">ä¸ªäººä¸­å¿ƒ</a>
            <a href="#" class="nav-link" onclick="logout()">é€€å‡ºç™»å½•</a>
        </div>
    </nav>

    <div class="profile-container">
        <!-- ä¸ªäººä¿¡æ¯å¤´éƒ¨ -->
        <div class="profile-header">
            <div class="profile-info">
                <div class="avatar" id="userAvatar">
                    <!-- å¤´åƒæ˜¾ç¤ºç”¨æˆ·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ -->
                </div>
                <div class="user-details">
                    <h1 id="userName">ç”¨æˆ·å</h1>
                    <p id="userEmail">é‚®ç®±åœ°å€</p>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-number" id="postCount">0</div>
                            <div class="stat-label">å‘å¸–æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="barCount">0</div>
                            <div class="stat-label">å…³æ³¨è´´å§</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="likeCount">0</div>
                            <div class="stat-label">è·èµæ•°</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="profile-tabs">
            <button class="tab active" onclick="switchTab('posts')">æˆ‘çš„å¸–å­</button>
            <button class="tab" onclick="switchTab('bars')">å…³æ³¨çš„è´´å§</button>
            <button class="tab" onclick="switchTab('settings')">è´¦å·è®¾ç½®</button>
        </div>

        <!-- æˆ‘çš„å¸–å­ -->
        <div id="posts-tab" class="tab-content active">
            <div class="posts-grid" id="postsGrid">
                <!-- å¸–å­å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å…³æ³¨çš„è´´å§ -->
        <div id="bars-tab" class="tab-content">
            <div class="bars-grid" id="barsGrid">
                <!-- è´´å§å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- è´¦å·è®¾ç½® -->
        <div id="settings-tab" class="tab-content">
            <div style="background: white; border-radius: 12px; padding: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">è´¦å·è®¾ç½®</h2>
                
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">åŸºæœ¬ä¿¡æ¯</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">æ˜µç§°</label>
                            <input type="text" style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="nicknameInput" placeholder="è¯·è¾“å…¥æ˜µç§°">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ä¸ªäººç®€ä»‹</label>
                            <textarea style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px; min-height: 100px;" id="bioInput" placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹"></textarea>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">é‚®ç®±åœ°å€</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="email" style="flex: 1; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="emailInput" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
                                <button type="button" class="btn btn-secondary" onclick="sendEmailVerification()" style="white-space: nowrap;">å‘é€éªŒè¯ç </button>
                            </div>
                            <div id="emailVerification" style="display: none; margin-top: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" style="flex: 1; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="verificationCode" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
                                    <button type="button" class="btn btn-primary" onclick="verifyEmail()">éªŒè¯</button>
                                </div>
                                <div id="emailStatus" style="font-size: 0.9rem; margin-top: 0.25rem;"></div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">æ€§åˆ«</label>
                                <select style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="genderSelect">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="male">ç”·</option>
                                    <option value="female">å¥³</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">å‡ºç”Ÿå¹´æœˆ</label>
                                <input type="date" style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="birthDateInput">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">å®‰å…¨è®¾ç½®</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ä¿®æ”¹å¯†ç </label>
                            <div style="display: grid; gap: 0.75rem;">
                                <input type="password" style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="currentPassword" placeholder="å½“å‰å¯†ç ">
                                <input type="password" style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="newPassword" placeholder="æ–°å¯†ç ">
                                <input type="password" style="width: 100%; padding: 0.75rem; border: 1px solid #e0e0e0; border-radius: 6px;" id="confirmPassword" placeholder="ç¡®è®¤æ–°å¯†ç ">
                                <button type="button" class="btn btn-secondary" onclick="changePassword()">ä¿®æ”¹å¯†ç </button>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">å®‰å…¨é€‰é¡¹</label>
                            <div style="display: grid; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="twoFactorAuth">
                                    <span>å¯ç”¨åŒé‡éªŒè¯</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="loginAlerts">
                                    <span>ç™»å½•æé†’</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="sessionTimeout">
                                    <span>è‡ªåŠ¨ç™»å‡ºï¼ˆ30åˆ†é’Ÿæ— æ“ä½œï¼‰</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">éšç§è®¾ç½®</h3>
                    <div style="display: grid; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="privateProfile">
                            <span>è®¾ä¸ºç§å¯†è´¦å·</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="hideEmail">
                            <span>éšè—é‚®ç®±åœ°å€</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="hideBirthday">
                            <span>éšè—å‡ºç”Ÿå¹´æœˆ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="hideGender">
                            <span>éšè—æ€§åˆ«</span>
                        </label>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">è´¦å·å®‰å…¨</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                            <h4 style="margin-bottom: 0.5rem;">ç™»å½•è®¾å¤‡ç®¡ç†</h4>
                            <p style="color: #666; margin-bottom: 1rem;">æŸ¥çœ‹å’Œç®¡ç†å·²ç™»å½•çš„è®¾å¤‡</p>
                            <button type="button" class="btn btn-secondary" onclick="viewLoginDevices()">æŸ¥çœ‹è®¾å¤‡</button>
                        </div>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                            <h4 style="margin-bottom: 0.5rem;">è´¦å·ä¿æŠ¤</h4>
                            <p style="color: #666; margin-bottom: 1rem;">å¢å¼ºè´¦å·å®‰å…¨ä¿æŠ¤</p>
                            <button type="button" class="btn btn-secondary" onclick="enableAccountProtection()">å¯ç”¨ä¿æŠ¤</button>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                    <button class="btn btn-secondary" onclick="resetSettings()">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLogin() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                alert('è¯·å…ˆç™»å½•ï¼');
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }
        
        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        function loadUserInfo() {
            if (!checkLogin()) return;
            
            const username = localStorage.getItem('username') || 'ç”¨æˆ·';
            const email = localStorage.getItem('email') || 'æœªè®¾ç½®é‚®ç®±';
            
            document.getElementById('userName').textContent = username;
            document.getElementById('userEmail').textContent = email;
            document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            loadUserStats();
            
            // åŠ è½½å¸–å­æ•°æ®
            loadUserPosts();
            
            // åŠ è½½è´´å§æ•°æ®
            loadUserBars();
        }
        
        // åŠ è½½ç”¨æˆ·ç»Ÿè®¡æ•°æ®
        function loadUserStats() {
            // æ¨¡æ‹Ÿæ•°æ®
            document.getElementById('postCount').textContent = '28';
            document.getElementById('barCount').textContent = '12';
            document.getElementById('likeCount').textContent = '356';
        }
        
        // åŠ è½½ç”¨æˆ·å¸–å­
        function loadUserPosts() {
            const postsGrid = document.getElementById('postsGrid');
            
            // æ¨¡æ‹Ÿå¸–å­æ•°æ®
            const posts = [
                {
                    title: 'ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‡ºå»èµ°èµ°',
                    content: 'é˜³å…‰æ˜åªšï¼Œå¾®é£ä¸ç‡¥ï¼ŒçœŸæ˜¯ä¸ªé€‚åˆæˆ·å¤–æ´»åŠ¨çš„å¥½æ—¥å­...',
                    time: '2å°æ—¶å‰',
                    likes: 15
                },
                {
                    title: 'åˆ†äº«ä¸€ä¸ªå­¦ä¹ ç¼–ç¨‹çš„å¥½æ–¹æ³•',
                    content: 'æœ€è¿‘å‘ç°é€šè¿‡é¡¹ç›®å®è·µæ¥å­¦ä¹ ç¼–ç¨‹æ•ˆæœç‰¹åˆ«å¥½...',
                    time: '1å¤©å‰',
                    likes: 42
                },
                {
                    title: 'å…³äºäººå·¥æ™ºèƒ½çš„æœªæ¥å‘å±•',
                    content: 'äººå·¥æ™ºèƒ½æŠ€æœ¯æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œæœªæ¥å°†ä¼šæ·±åˆ»æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»...',
                    time: '3å¤©å‰',
                    likes: 89
                },
                {
                    title: 'æ¨èå‡ æœ¬æœ€è¿‘è¯»çš„å¥½ä¹¦',
                    content: 'ã€Šä¸‰ä½“ã€‹ç³»åˆ—çœŸçš„è®©äººéœ‡æ’¼ï¼Œç§‘å¹»è¿·å¿…è¯»...',
                    time: '5å¤©å‰',
                    likes: 67
                },
                {
                    title: 'å‘¨æœ«å»çˆ¬å±±çš„ç…§ç‰‡åˆ†äº«',
                    content: 'å±±é¡¶çš„é£æ™¯å¤ªç¾äº†ï¼Œè™½ç„¶ç´¯ä½†å¾ˆå€¼å¾—...',
                    time: '1å‘¨å‰',
                    likes: 124
                },
                {
                    title: 'Pythonæ•°æ®åˆ†æå®æˆ˜ç»éªŒ',
                    content: 'ä½¿ç”¨pandaså’Œmatplotlibå¤„ç†æ•°æ®çœŸçš„å¾ˆæ–¹ä¾¿...',
                    time: '2å‘¨å‰',
                    likes: 98
                },
                {
                    title: 'æœ€è¿‘è¿·ä¸Šäº†æ‘„å½±ï¼Œæ±‚æŒ‡å¯¼',
                    content: 'åˆšå…¥æ‰‹å•åï¼Œè¿˜åœ¨å­¦ä¹ æ„å›¾å’Œå…‰çº¿æ§åˆ¶...',
                    time: '3å‘¨å‰',
                    likes: 56
                },
                {
                    title: 'æ—…è¡Œæ”»ç•¥ï¼šäº‘å—å¤§ç†è‡ªç”±è¡Œ',
                    content: 'å¤§ç†çš„æ´±æµ·å’Œå¤åŸçœŸçš„å¾ˆç¾ï¼Œå¼ºçƒˆæ¨è...',
                    time: '1æœˆå‰',
                    likes: 203
                }
            ];
            
            if (posts.length === 0) {
                postsGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å¸–å­</h3>
                        <p>å»è´´å§å‘å¸–ï¼Œåˆ†äº«ä½ çš„æƒ³æ³•å§ï¼</p>
                        <button class="btn btn-primary" onclick="window.location.href='bars.html'">å»å‘å¸–</button>
                    </div>
                `;
                return;
            }
            
            postsGrid.innerHTML = posts.map(post => `
                <div class="post-card">
                    <div class="post-image">${getPostEmoji(post.title)}</div>
                    <div class="post-content-wrapper">
                        <div class="post-title">${post.title}</div>
                        <div class="post-content">${post.content}</div>
                        <div class="post-meta">
                            <span>${post.time}</span>
                            <span>â¤ï¸ ${post.likes}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // è·å–å¸–å­è¡¨æƒ…ç¬¦å·
        function getPostEmoji(title) {
            const emojiMap = {
                'Vue3': 'ğŸ“±',
                'React': 'âš›ï¸',
                'JavaScript': 'ğŸ’»',
                'Python': 'ğŸ',
                'æ‘„å½±': 'ğŸ“·',
                'æ—…è¡Œ': 'ğŸ”ï¸',
                'ç”µå½±': 'ğŸ¬',
                'å¥èº«': 'ğŸ’ª',
                'æ¸¸æˆ': 'ğŸ®',
                'ç¾é£Ÿ': 'ğŸ²',
                'è‚¡ç¥¨': 'ğŸ“ˆ',
                'å¥½ä¹¦': 'ğŸ“š',
                'çˆ¬å±±': 'â›°ï¸',
                'æ•°æ®åˆ†æ': 'ğŸ“Š',
                'å­¦ä¹ ': 'ğŸ“–',
                'äº‘å—': 'ğŸï¸'
            };
            
            for (const [keyword, emoji] of Object.entries(emojiMap)) {
                if (title.includes(keyword)) {
                    return emoji;
                }
            }
            return 'ğŸ“„';
        }
        
        // åŠ è½½ç”¨æˆ·å…³æ³¨çš„è´´å§
        function loadUserBars() {
            const barsGrid = document.getElementById('barsGrid');
            
            // æ¨¡æ‹Ÿè´´å§æ•°æ®
            const bars = [
                { name: 'ç¼–ç¨‹', members: '12.5ä¸‡', followed: true },
                { name: 'æ‘„å½±', members: '8.7ä¸‡', followed: true },
                { name: 'æ—…è¡Œ', members: '15.3ä¸‡', followed: true },
                { name: 'ç¾é£Ÿ', members: '23.1ä¸‡', followed: true },
                { name: 'æ¸¸æˆ', members: '18.9ä¸‡', followed: true },
                { name: 'ç”µå½±', members: '14.2ä¸‡', followed: true },
                { name: 'éŸ³ä¹', members: '11.3ä¸‡', followed: true },
                { name: 'è¯»ä¹¦', members: '6.7ä¸‡', followed: true },
                { name: 'å¥èº«', members: '7.6ä¸‡', followed: true },
                { name: 'åŠ¨æ¼«', members: '15.6ä¸‡', followed: true },
                { name: 'æ•°ç ', members: '10.2ä¸‡', followed: true },
                { name: 'æ±½è½¦', members: '9.4ä¸‡', followed: true }
            ];
            
            if (bars.length === 0) {
                barsGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>è¿˜æ²¡æœ‰å…³æ³¨ä»»ä½•è´´å§</h3>
                        <p>å»å‘ç°æœ‰è¶£çš„è´´å§å§ï¼</p>
                        <button class="btn btn-primary" onclick="window.location.href='bars.html'">æµè§ˆè´´å§</button>
                    </div>
                `;
                return;
            }
            
            barsGrid.innerHTML = bars.map(bar => `
                <div class="bar-card">
                    <div class="bar-name">${bar.name}å§</div>
                    <div class="bar-members">${bar.members} æˆå‘˜</div>
                    <button class="btn btn-outline" onclick="unfollowBar('${bar.name}')">å–æ¶ˆå…³æ³¨</button>
                </div>
            `).join('');
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µæŒ‰é’®çš„activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ä¸ºé€‰ä¸­çš„æ ‡ç­¾é¡µæŒ‰é’®æ·»åŠ activeç±»
            event.target.classList.add('active');
        }
        
        // å–æ¶ˆå…³æ³¨è´´å§
        function unfollowBar(barName) {
            if (confirm(`ç¡®å®šè¦å–æ¶ˆå…³æ³¨ ${barName}å§ å—ï¼Ÿ`)) {
                alert(`å·²å–æ¶ˆå…³æ³¨ ${barName}å§`);
                loadUserBars(); // é‡æ–°åŠ è½½è´´å§åˆ—è¡¨
            }
        }
        
        // å‘é€é‚®ç®±éªŒè¯ç 
        function sendEmailVerification() {
            const email = document.getElementById('emailInput').value;
            if (!email) {
                alert('è¯·è¾“å…¥é‚®ç®±åœ°å€');
                return;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                return;
            }
            
            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
            const verificationCode = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem('emailVerificationCode', verificationCode.toString());
            localStorage.setItem('emailVerificationTime', Date.now().toString());
            
            // æ˜¾ç¤ºéªŒè¯ç è¾“å…¥åŒºåŸŸ
            document.getElementById('emailVerification').style.display = 'block';
            document.getElementById('emailStatus').textContent = 'éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œæœ‰æ•ˆæœŸä¸º10åˆ†é’Ÿ';
            document.getElementById('emailStatus').style.color = '#28a745';
            
            // ç¦ç”¨å‘é€æŒ‰é’®60ç§’
            const sendButton = document.querySelector('button[onclick="sendEmailVerification()"]');
            sendButton.disabled = true;
            sendButton.textContent = '60ç§’åé‡å‘';
            
            let countdown = 60;
            const timer = setInterval(() => {
                countdown--;
                sendButton.textContent = `${countdown}ç§’åé‡å‘`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    sendButton.disabled = false;
                    sendButton.textContent = 'å‘é€éªŒè¯ç ';
                }
            }, 1000);
        }
        
        // éªŒè¯é‚®ç®±
        function verifyEmail() {
            const code = document.getElementById('verificationCode').value;
            const storedCode = localStorage.getItem('emailVerificationCode');
            const storedTime = localStorage.getItem('emailVerificationTime');
            
            if (!code) {
                alert('è¯·è¾“å…¥éªŒè¯ç ');
                return;
            }
            
            if (!storedCode || !storedTime) {
                alert('è¯·å…ˆå‘é€éªŒè¯ç ');
                return;
            }
            
            // æ£€æŸ¥éªŒè¯ç æ˜¯å¦è¿‡æœŸï¼ˆ10åˆ†é’Ÿï¼‰
            const currentTime = Date.now();
            if (currentTime - parseInt(storedTime) > 10 * 60 * 1000) {
                alert('éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°å‘é€');
                return;
            }
            
            if (code === storedCode) {
                const email = document.getElementById('emailInput').value;
                localStorage.setItem('email', email);
                localStorage.setItem('emailVerified', 'true');
                
                document.getElementById('emailStatus').textContent = 'é‚®ç®±éªŒè¯æˆåŠŸï¼';
                document.getElementById('emailStatus').style.color = '#28a745';
                alert('é‚®ç®±éªŒè¯æˆåŠŸï¼');
            } else {
                document.getElementById('emailStatus').textContent = 'éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                document.getElementById('emailStatus').style.color = '#dc3545';
            }
        }
        
        // ä¿®æ”¹å¯†ç 
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¯†ç å­—æ®µ');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('æ–°å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä½');
                return;
            }
            
            // æ¨¡æ‹Ÿå¯†ç ä¿®æ”¹æˆåŠŸ
            alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            
            // æ¸…ç©ºå¯†ç å­—æ®µ
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        // æŸ¥çœ‹ç™»å½•è®¾å¤‡
        function viewLoginDevices() {
            alert('ç™»å½•è®¾å¤‡ç®¡ç†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }
        
        // å¯ç”¨è´¦å·ä¿æŠ¤
        function enableAccountProtection() {
            alert('è´¦å·ä¿æŠ¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }
        
        // é‡ç½®è®¾ç½®
        function resetSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‚¨å½“å‰çš„è®¾ç½®ã€‚')) {
                document.getElementById('nicknameInput').value = '';
                document.getElementById('bioInput').value = '';
                document.getElementById('emailInput').value = '';
                document.getElementById('genderSelect').value = '';
                document.getElementById('birthDateInput').value = '';
                document.getElementById('privateProfile').checked = false;
                document.getElementById('hideEmail').checked = false;
                document.getElementById('hideBirthday').checked = false;
                document.getElementById('hideGender').checked = false;
                document.getElementById('twoFactorAuth').checked = false;
                document.getElementById('loginAlerts').checked = false;
                document.getElementById('sessionTimeout').checked = false;
                
                alert('è®¾ç½®å·²é‡ç½®');
            }
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const nickname = document.getElementById('nicknameInput').value;
            const bio = document.getElementById('bioInput').value;
            const email = document.getElementById('emailInput').value;
            const gender = document.getElementById('genderSelect').value;
            const birthDate = document.getElementById('birthDateInput').value;
            const privateProfile = document.getElementById('privateProfile').checked;
            const hideEmail = document.getElementById('hideEmail').checked;
            const hideBirthday = document.getElementById('hideBirthday').checked;
            const hideGender = document.getElementById('hideGender').checked;
            const twoFactorAuth = document.getElementById('twoFactorAuth').checked;
            const loginAlerts = document.getElementById('loginAlerts').checked;
            const sessionTimeout = document.getElementById('sessionTimeout').checked;
            
            // éªŒè¯é‚®ç®±æ˜¯å¦å·²éªŒè¯
            const emailVerified = localStorage.getItem('emailVerified') === 'true';
            if (email && !emailVerified) {
                alert('è¯·å…ˆéªŒè¯é‚®ç®±åœ°å€');
                return;
            }
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('nickname', nickname);
            localStorage.setItem('bio', bio);
            localStorage.setItem('email', email);
            localStorage.setItem('gender', gender);
            localStorage.setItem('birthDate', birthDate);
            localStorage.setItem('privateProfile', privateProfile);
            localStorage.setItem('hideEmail', hideEmail);
            localStorage.setItem('hideBirthday', hideBirthday);
            localStorage.setItem('hideGender', hideGender);
            localStorage.setItem('twoFactorAuth', twoFactorAuth);
            localStorage.setItem('loginAlerts', loginAlerts);
            localStorage.setItem('sessionTimeout', sessionTimeout);
            
            alert('è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // æ¸…é™¤ç¼“å­˜å¹¶å¯¼èˆª
        function clearCacheAndNavigate(url) {
            event.preventDefault();
            window.location.href = url + '?' + new Date().getTime();
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                localStorage.removeItem('email');
                window.location.href = 'index.html?' + new Date().getTime();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadUserSettings();
        });
        
        // åŠ è½½ç”¨æˆ·è®¾ç½®
        function loadUserSettings() {
            const nickname = localStorage.getItem('nickname') || '';
            const bio = localStorage.getItem('bio') || '';
            const email = localStorage.getItem('email') || '';
            const gender = localStorage.getItem('gender') || '';
            const birthDate = localStorage.getItem('birthDate') || '';
            const privateProfile = localStorage.getItem('privateProfile') === 'true';
            const hideEmail = localStorage.getItem('hideEmail') === 'true';
            const hideBirthday = localStorage.getItem('hideBirthday') === 'true';
            const hideGender = localStorage.getItem('hideGender') === 'true';
            const twoFactorAuth = localStorage.getItem('twoFactorAuth') === 'true';
            const loginAlerts = localStorage.getItem('loginAlerts') === 'true';
            const sessionTimeout = localStorage.getItem('sessionTimeout') === 'true';
            
            // è®¾ç½®è¡¨å•å€¼
            document.getElementById('nicknameInput').value = nickname;
            document.getElementById('bioInput').value = bio;
            document.getElementById('emailInput').value = email;
            document.getElementById('genderSelect').value = gender;
            document.getElementById('birthDateInput').value = birthDate;
            document.getElementById('privateProfile').checked = privateProfile;
            document.getElementById('hideEmail').checked = hideEmail;
            document.getElementById('hideBirthday').checked = hideBirthday;
            document.getElementById('hideGender').checked = hideGender;
            document.getElementById('twoFactorAuth').checked = twoFactorAuth;
            document.getElementById('loginAlerts').checked = loginAlerts;
            document.getElementById('sessionTimeout').checked = sessionTimeout;
            
            // å¦‚æœé‚®ç®±å·²éªŒè¯ï¼Œæ˜¾ç¤ºéªŒè¯çŠ¶æ€
            const emailVerified = localStorage.getItem('emailVerified') === 'true';
            if (emailVerified && email) {
                document.getElementById('emailStatus').textContent = 'é‚®ç®±å·²éªŒè¯';
                document.getElementById('emailStatus').style.color = '#28a745';
            }
        }
    </script>
</body>
</html>